<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>JoyEngineECS(JoyEngine 4 WebGL2.0)</title>
    <style>
        body {
            font-family: arial;
            margin: 0;
            padding: none;
        }

        .joyengineecs {
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        div.joyengineecs {
            text-align: center;
        }

        div.joyengineecs_border {
            border: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
            /* Full viewport height */
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
        canvas.joyengineecs {
            border: 0px none;
            background-color: black;
        }
    </style>
</head>

<body>
    <div class="joyengineecs_border">
        <canvas class="joyengineecs" id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>
        <img src="./icon/cinoicon_light.png" alt="Cino Icon"
            style="position: absolute; bottom: 10px; left: 10px; transform: translateX(0) scale(0.1); transform-origin: left bottom;">

        <img src="./icon/Joy.gif" alt="Icon"
            style="position: absolute; bottom: 10px; left: 120px; transform: translateX(0) scale(0.4); transform-origin: left bottom;">

        <div style="position: absolute; bottom: 10px; left: 200px; color: black; font-size: 16px;">
            (C)Cinogama project 2025. Powered by JoyEngine 4 WebGL 2.0.</div>

        <div id="progressBarContainer"
            style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50%; height: 5px; background-color: #105a5a;">
            <div id="progressBar" style="width: 0%; height: 100%; background-color: #00ffff;"></div>
        </div>
    </div>

    <script>
        function setProgress(progress) {
            var progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
        }
        function getProgress() {
            var progressBar = document.getElementById('progressBar');
            return parseInt(progressBar.style.width);
        }
        function setProgressAlpha(alpha) {
            var progressBarContainer = document.getElementById('progressBarContainer');
            progressBarContainer.style.opacity = alpha;
        }
    </script>

    <script type='text/javascript'>

        var Module = {
            print: (function () {
                // Do nothing.
            })(),
            canvas: (() => {
                var canvas = document.getElementById('canvas');

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                // As a default initial behavior, pop up an alert when webgl context is lost. To make your
                // application robust, you may want to override this behavior before shipping!
                // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
                canvas.addEventListener("webglcontextlost",
                    (e) => {
                        alert('WebGL context lost. You will need to reload the page.');
                        e.preventDefault();
                    },
                    false);

                return canvas;
            })(),
            setStatus: (text) => {
                Module.setStatus.last ??= { time: Date.now(), text: '' };
                if (text === Module.setStatus.last.text) return;
                var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
                var now = Date.now();
                if (m && now - Module.setStatus.last.time < 30)
                    // if this is a progress update, skip it if too soon
                    return;
                Module.setStatus.last.time = now;
                Module.setStatus.last.text = text;
                if (m) {
                    // text = m[1];
                    // progressElement.value = parseInt(m[2]) * 100;
                    // progressElement.max = parseInt(m[4]) * 100;
                    setProgressAlpha(1);
                    setProgress(parseInt(m[2]) * 100 / parseInt(m[4]));
                } else {
                    setProgress(100);

                    setProgressAlpha(1);
                    setTimeout(() => {
                        let alpha = 1;
                        const fadeOutInterval = setInterval(() => {
                            alpha -= 0.05;
                            setProgressAlpha(alpha);

                            if (getProgress() != 100 ||  alpha <= 0) {
                                clearInterval(fadeOutInterval);
                            }
                        }, 30);
                    }, 500);
                }
            },
            totalDependencies: 0,
            monitorRunDependencies: (left) => {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                Module.setStatus(left
                    ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')'
                    : 'All downloads complete.');
            }
        };
        
        Module.setStatus('Downloading...');
        window.onerror = (event) => {
            alert('Exception thrown, see JavaScript console:\n  ' + event);
            Module.setStatus = (text) => {
                if (text) console.error('[post-exception status] ' + text);
            };
        };
    </script>
    <script async type="text/javascript" src="joyengineecs4w.js"></script>
</body>

</html>